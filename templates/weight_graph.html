<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>체중 기록</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <!-- Chart.js 먼저 로드 (필수) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif; padding: 20px; }
        label { display:block; margin-top:8px; }
        form { margin-bottom: 18px; }
        #chart-container { width: 100%; max-width: 800px; height: 360px; margin-top:20px; }
        /* canvas는 부모 높이를 따르도록 */
        #weightsChart { width:100% !important; height:360px !important; display:block; }
    </style>
</head>
<body>
    <h1>매일 체중 입력</h1>

    <form action="{{ url_for('weights.add_weight') }}" method="post">
        <label>날짜 (비워두면 오늘):</label>
        <input type="date" name="date" />

        <label>체중 (kg):</label>
        <input type="number" name="weight" step="0.1" required />

        <button type="submit">저장</button>
    </form>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <ul>
        {% for category, msg in messages %}
        <li><strong>{{ category }}:</strong> {{ msg }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    {% endwith %}

    <h2>최근 기록</h2>
    <ul>
        {% for item in weights[-7:]|reverse %}
        <li>{{ item.date }} — {{ item.weight }} kg</li>
        {% else %}
        <li>기록이 없습니다.</li>
        {% endfor %}
    </ul>

    <h2>체중 변화 그래프</h2>
    <div id="chart-container">
        <canvas id="weightsChart"></canvas>
    </div>

    <!-- weights_chart.js: Chart.js가 로드된 뒤에 로드되어야 함 -->
    <script src="{{ url_for('static', filename='js/weights_chart.js') }}"></script>
</body>
</html>